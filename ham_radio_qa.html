<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ham Radio Q&A</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        table { border-collapse: collapse; width: 100%; max-width: 600px; margin-top: 20px; }
        td { border: 1px solid #ddd; padding: 8px; }
        .hidden { display: none; }
    </style>
</head>
<body>
    <h1>Ham Radio Q&A</h1>
    <input type="text" id="question" placeholder="Ask a ham radio question..." style="width: 100%; max-width: 400px; padding: 5px;">
    <button onclick="search()" style="padding: 5px 10px;">Search</button>
    <table id="resultsTable" class="hidden">
        <tbody></tbody>
    </table>

    <script>
        const SERPAPI_KEY = "46b4ae5abdc691ccd91439eb91a78074f55726312191b3f12d4ecf34577456ea";

        const mockData = [
            { question: "what is qrm", answers: ["Sample answer: QRM is interference in ham radio."] },
            { question: "dummy load", answers: ["Sample answer: A dummy load is used for testing."] }
        ];

        function categorizeAnswer(question) {
            const q = question.toLowerCase();
            if (q.includes("antenna")) return "Antennas";
            if (q.includes("radio") || q.includes("transmitter")) return "Equipment";
            return "General";
        }

        async function search() {
            const question = document.getElementById("question").value.trim();
            if (!question) {
                alert("Please enter a question.");
                return;
            }

            const category = categorizeAnswer(question);
            let answers = [];

            try {
                console.log("Starting API call...");
                const response = await fetch(
                    `https://serpapi.com/search.json?q=${encodeURIComponent(
                        `ham radio ${question} site:eham.net | site:arrl.org | site:qrz.com`
                    )}&num=3&api_key=${SERPAPI_KEY}`
                );
                console.log("API response status:", response.status);

                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }

                const data = await response.json();
                console.log("API response data:", data);

                answers = data.organic_results && data.organic_results.length > 0
                    ? data.organic_results.map(result => result.snippet || "No snippet available.").slice(0, 3)
                    : mockData.find(item => item.question.toLowerCase().includes(question.toLowerCase()))?.answers || [`Sample answer for "${question}" from Ham Radio sites.`];
            } catch (e) {
                console.error("SerpApi failed:", e);
                answers = mockData.find(item => item.question.toLowerCase().includes(question.toLowerCase()))?.answers || [`Sample answer for "${question}" from Ham Radio sites.`];
            }

            const table = document.getElementById("resultsTable");
            table.classList.remove("hidden");
            const tbody = table.querySelector("tbody");
            tbody.innerHTML = `
                <tr><td>Category</td><td>${category}</td></tr>
                <tr><td>Question</td><td>${question}</td></tr>
                ${answers.map((ans, i) => `<tr><td>Answer ${i + 1}</td><td>${ans}</td></tr>`).join("")}
            `;
            document.getElementById("question").value = "";
        }
    </script>
</body>
</html>
